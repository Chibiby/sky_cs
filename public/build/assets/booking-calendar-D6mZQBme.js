import{e as le,c as x,t as ie,U as g,r as h,h as T,f as r,j as e,L as ce,i as oe,s as D,k as U,l as de,n as me,o as he}from"./app-UEX2vF-v.js";import{A as xe}from"./app-layout-B9ez7mmX.js";import{C as ue,c as fe}from"./card-Bqio-jOF.js";import{S as W,a as z,b as B,c as P,d as u}from"./select-D6XMwjn6.js";import{c as F,B as N}from"./button-D8mT6hG0.js";import{L as pe}from"./loader-circle-RL3YyG7k.js";import{C as ge}from"./index-BVB0vcGq.js";import"./index-DYcKATcv.js";import"./index-BQlWczXX.js";import"./index-B7oQHXnP.js";import"./app-logo-icon-DMFLlZgW.js";import"./index-CliozYHi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ve=F("ChevronLeft",ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ne=F("RefreshCw",je);function C(l,c){le(2,arguments);var b=ie(c);return x(l,-b)}function Ie({reservations:l}){const[c,b]=g.useState("all"),[o,M]=g.useState("weekly"),[y,v]=g.useState(()=>{const s=new Date,t=s.getDay();return C(s,t)}),[f,R]=h.useState({villas:0,cottages:0,cabins:0}),[H,A]=h.useState(!0),[w,$]=h.useState([]),[q,G]=h.useState(new Date),[L,V]=h.useState(!1);h.useEffect(()=>{(async()=>{try{A(!0);const t=await T.get("/api/rooms/count");console.log("Room counts from API:",t.data),R(t.data)}catch(t){console.error("Error fetching room counts:",t),R({villas:5,cottages:9,cabins:9})}finally{A(!1)}})()},[]);const j=h.useCallback(async()=>{try{V(!0);const s=await T.get(`/api/reservations/current?t=${new Date().getTime()}`);console.log("Fetched reservations:",s.data),$(s.data),G(new Date)}catch(s){console.error("Error fetching reservations:",s),l&&l.length>0?$(l):w.length===0&&$(K)}finally{V(!1)}},[l]);h.useEffect(()=>{j()},[j]),h.useEffect(()=>{j();const s=setInterval(()=>{j()},5e3);return()=>clearInterval(s)},[j]);const J=()=>{j()},K=[{id:101,guest_name:"Brandanlee",room_name:"Villa 1",check_in:"2025-04-14",check_out:"2025-04-15",status:"pending",accommodation_id:1},{id:102,guest_name:"sample",room_name:"Villa 2",check_in:"2025-04-14",check_out:"2025-04-15",status:"pending",accommodation_id:2},{id:103,guest_name:"hellws",room_name:"Villa 3",check_in:"2025-04-14",check_out:"2025-04-17",status:"pending",accommodation_id:3},{id:104,guest_name:"Brandanlee",room_name:"Villa 4",check_in:"2025-04-14",check_out:"2025-04-17",status:"arrival",accommodation_id:4},{id:105,guest_name:"testing",room_name:"Villa 5",check_in:"2025-04-14",check_out:"2025-04-17",status:"pending",accommodation_id:5}],Q=g.useMemo(()=>{console.log("Processing reservations:",w);const s=w.map(t=>({...t,check_in:typeof t.check_in=="string"?new Date(t.check_in):t.check_in,check_out:typeof t.check_out=="string"?new Date(t.check_out):t.check_out}));return console.log("All processed reservations:",s),s},[w]),d=g.useMemo(()=>{const s=Array.from({length:f.villas},(m,p)=>`Villa ${p+1}`),t=Array.from({length:f.cottages},(m,p)=>`Cottage ${p+1}`),a=Array.from({length:f.cabins},(m,p)=>`Cabin ${p+1}`),i=[...s,...t,...a];return console.log("Generated accommodations list:",i),i},[f]),k=g.useMemo(()=>c==="all"?d:c==="villas"?d.filter(s=>s.startsWith("Villa")):c==="cottages"?d.filter(s=>s.startsWith("Cottage")):c==="cabins"?d.filter(s=>s.startsWith("Cabin")):d.filter(s=>s.toLowerCase().replace(" ","-")===c),[c,d]),E=g.useMemo(()=>Array.from({length:24},(s,t)=>`${t.toString().padStart(2,"0")}:00`),[]),X=()=>{v(o==="daily"?s=>C(s,1):o==="weekly"?s=>C(s,7):s=>D(C(D(s),1)))},Y=()=>{v(o==="daily"?s=>x(s,1):o==="weekly"?s=>x(s,7):s=>D(x(U(s),1)))},n={start:y,end:x(y,6)};console.log("Current date range:",{start:r(n.start,"yyyy-MM-dd"),end:r(n.end,"yyyy-MM-dd")});const Z=d.filter(s=>s.startsWith("Villa")),ee=d.filter(s=>s.startsWith("Cottage")),se=d.filter(s=>s.startsWith("Cabin"));Z.length+ee.length+se.length;const te=s=>{switch(s){case"pending":return"bg-yellow-500";case"arrival":return"bg-blue-500";case"cancelled":return"bg-red-500";case"completed":return"bg-green-500";default:return"bg-gray-300"}},ae=s=>`${s.guest_name} - ${r(new Date(s.check_in),"MMM dd")} to ${r(new Date(s.check_out),"MMM dd")} - ${s.status}`,ne=(s,t)=>t.filter(a=>{if(a.room_name===s)return!0;if(a.accommodation_id){const i=Me(a.accommodation_id);return console.log(`Comparing: reservation room (${a.room_name}) / mapped from ID ${a.accommodation_id} (${i}) / with current room (${s})`),i===s}return!1});return e.jsxs(xe,{breadcrumbs:[{title:"Booking Calendar",href:"/reservations/booking-calendar"}],children:[e.jsx(ce,{title:"Booking Calendar"}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"container mx-auto space-y-6 select-none",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"View and manage room availability and reservations across all accommodations"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Last updated: ",r(q,"MMM d, yyyy HH:mm:ss")]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:J,disabled:L,children:[e.jsx(Ne,{className:`h-4 w-4 mr-1 ${L?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsx(ue,{className:"rounded-lg",children:e.jsx(fe,{children:H?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(pe,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Loading rooms from database..."})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-[140px]",children:e.jsxs(W,{value:c,onValueChange:b,children:[e.jsx(z,{children:e.jsx(B,{placeholder:"All Rooms"})}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"All Rooms"}),e.jsxs(u,{value:"villas",children:["All Villas (",f.villas,")"]}),e.jsxs(u,{value:"cottages",children:["All Cottages (",f.cottages,")"]}),e.jsxs(u,{value:"cabins",children:["All Cabins (",f.cabins,")"]}),d.map(s=>e.jsx(u,{value:s.toLowerCase().replace(" ","-"),children:s},s))]})]})}),e.jsx("div",{className:"sm:hidden",children:e.jsxs(W,{value:o,onValueChange:M,children:[e.jsx(z,{className:"w-[100px]",children:e.jsx(B,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"daily",children:"Daily"}),e.jsx(u,{value:"weekly",children:"Weekly"}),e.jsx(u,{value:"monthly",children:"Monthly"})]})]})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[e.jsx(N,{variant:o==="daily"?"default":"outline",onClick:()=>M("daily"),className:"px-3",size:"sm",children:"Daily"}),e.jsx(N,{variant:o==="weekly"?"default":"outline",onClick:()=>M("weekly"),className:"px-3",size:"sm",children:"Weekly"}),e.jsx(N,{variant:o==="monthly"?"default":"outline",onClick:()=>M("monthly"),className:"px-3",size:"sm",children:"Monthly"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(N,{variant:"outline",onClick:X,size:"sm",className:"px-2",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:"Previous"})]}),e.jsxs(N,{variant:"outline",onClick:Y,size:"sm",className:"px-2",children:[e.jsx("span",{className:"hidden sm:inline mr-1",children:"Next"}),e.jsx(ge,{className:"h-4 w-4"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto max-w-[950px]",children:o==="weekly"?e.jsxs("div",{className:"flex min-w-[800px]",children:[e.jsxs("div",{className:"w-40 border-r",children:[e.jsx("div",{className:"h-[84px] border-b px-4 flex items-end pb-2 font-medium",children:"Rooms"}),e.jsx("div",{className:"space-y-0",children:k.map(s=>e.jsx("div",{className:"px-4 h-[52px] flex items-center text-sm border-b last:border-b-0",children:s},s))})]}),e.jsx("div",{className:"flex-1 overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px] flex flex-col h-full",children:[e.jsx("div",{className:"h-[44px] flex items-center px-4 border-b text-lg font-medium",children:r(n.start,"MMMM")!==r(x(n.start,6),"MMMM")?`${r(n.start,"MMMM")} - ${r(x(n.start,6),"MMMM")} ${r(n.start,"yyyy")}`:`${r(n.start,"MMMM yyyy")}`}),e.jsx("div",{className:"grid grid-cols-7 border-b h-[40px]",children:Array.from({length:7}).map((s,t)=>{const a=x(n.start,t);return e.jsxs("div",{className:"border-r flex flex-col justify-center",children:[e.jsx("div",{className:"px-4 text-center text-sm text-muted-foreground",children:r(a,"EEE")}),e.jsx("div",{className:"px-4 text-center font-medium",children:r(a,"d")})]},t)})}),k.map(s=>{const t=ne(s,Q);return console.log(`Reservations for ${s}:`,t),e.jsxs("div",{className:"grid grid-cols-7 border-b h-[52px] relative",children:[Array.from({length:7}).map((a,i)=>(x(n.start,i),e.jsx("div",{className:"border-r relative group hover:bg-accent/50 transition-colors h-full"},i))),t.map(a=>{const i=new Date(a.check_in),m=new Date(a.check_out);if(console.log(`Checking reservation for ${s}:`,{id:a.id,name:a.guest_name,startDate:r(i,"yyyy-MM-dd"),endDate:r(m,"yyyy-MM-dd"),weekStart:r(n.start,"yyyy-MM-dd"),weekEnd:r(n.end,"yyyy-MM-dd"),isOutsideRange:m<n.start||i>n.end}),m<n.start||i>n.end)return console.log("Skipping - outside date range"),null;const p=i<n.start?n.start:i,re=m>n.end?n.end:m,_=Math.round((p.getTime()-n.start.getTime())/(24*60*60*1e3)),S=Math.round((re.getTime()-n.start.getTime())/(24*60*60*1e3)),I=`${(S-_+1)*(100/7)}%`,O=`${_*(100/7)}%`;return console.log("Reservation positioning (fixed):",{reservation:a.room_name,guest:a.guest_name,startDiff:_,endDiff:S,daysDiff:S-_+1,width:I,left:O,checkIn:r(i,"yyyy-MM-dd"),checkOut:r(m,"yyyy-MM-dd")}),e.jsx("div",{className:`absolute h-[40px] top-[6px] z-10 rounded-md px-2 text-xs text-white font-medium flex items-center justify-start overflow-hidden whitespace-nowrap shadow-md border-2 border-white ${te(a.status)}`,style:{left:O,width:I},title:ae(a),children:a.guest_name},a.id)})]},s)})]})})]}):o==="daily"?e.jsxs("div",{className:"flex min-w-[1000px]",children:[e.jsxs("div",{className:"w-40 border-r flex-shrink-0",children:[e.jsx("div",{className:"h-[44px] border-b"}),e.jsx("div",{className:"h-[40px] border-b flex items-center justify-center font-medium",children:"Time"}),e.jsx("div",{children:E.map(s=>e.jsx("div",{className:"h-[52px] flex items-center justify-center text-sm border-b",children:s},s))})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"h-[44px] flex items-center px-4 border-b text-lg font-medium",children:r(y,"MMMM d, yyyy")}),e.jsx("div",{className:"h-[40px] flex border-b",children:k.map(s=>e.jsx("div",{className:"w-[110px] border-r flex items-center justify-center",children:e.jsx("span",{className:"font-medium text-sm whitespace-nowrap",children:s})},s))}),e.jsx("div",{children:E.map(s=>e.jsx("div",{className:"flex border-b",children:k.map(t=>e.jsx("div",{className:"w-[110px] h-[52px] border-r relative group hover:bg-accent/50 transition-colors"},`${s}-${t}`))},s))})]})})]}):e.jsxs("div",{className:"flex flex-col min-w-[800px]",children:[e.jsx("div",{className:"h-[44px] flex items-center px-4 border-b text-lg font-medium",children:r(y,"MMMM yyyy")}),e.jsx("div",{className:"grid grid-cols-7 border-b",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"h-[40px] border-r last:border-r-0 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium",children:s})},s))}),e.jsx("div",{className:"grid grid-cols-7 grid-rows-6 h-[312px]",children:be(y).map((s,t)=>e.jsx("div",{className:`border-r border-b p-1 relative ${oe(s,y)?"":"bg-gray-50 text-gray-400"}`,children:e.jsx("span",{className:"text-sm font-medium",children:r(s,"d")})},t))})]})}),e.jsxs("div",{className:"flex items-center justify-start gap-4 pt-4 mt-4 border-t",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-4 w-4 rounded-full bg-yellow-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"Pending"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-4 w-4 rounded-full bg-blue-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"Arrival"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-4 w-4 rounded-full bg-red-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"Cancelled"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-4 w-4 rounded-full bg-green-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"Completed"})]})]})]})})})]})})]})}function be(l){const c=de(D(l)),b=me(U(l));return he({start:c,end:b})}function Me(l){return l>=1&&l<=5?`Villa ${l}`:l>=6&&l<=14?`Cottage ${l-5}`:l>=15&&l<=23?`Cabin ${l-14}`:"Unknown"}export{Ie as default};
