import{K,r as S,j as e,L as $,f as y,c as R,h as A,S as W}from"./app-BoMxmGmn.js";import{C as Y,a as Q,b as U,c as X}from"./card-Bt2OOCth.js";import{I as h}from"./input-DLQT4p2o.js";import{c as Z,B as I}from"./button-BcE1uX_y.js";import{L as i}from"./label-CM92CTjF.js";import{S as F,a as O,b as q,c as M,d as f}from"./select-DiQSI_et.js";import{A as ee}from"./app-layout-Dc5iTiDI.js";import{y as p,L as se}from"./ReactToastify-BBuHDRmW.js";import{u as te}from"./useBookingForm-DCXJHwpS.js";import{D as re,a as ae,b as oe,c as ne,e as ce,d as ie}from"./dialog-CZyb01Hk.js";import"./index-BCXwJxLk.js";import"./index-IUDIZFJl.js";import"./index-Dyd8yf9s.js";import"./index-CyAnqHq-.js";import"./index-UPM5sHVU.js";import"./app-logo-icon-HSaycr-V.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],de=Z("CircleCheckBig",le),me=()=>{const o=document.querySelector(".inertia-error");if(o)try{const j=o.textContent||"";console.log("Found JSON text:",j);const c=j.match(/\{.*\}/);if(c){const l=JSON.parse(c[0]);if(console.log("Parsed JSON data:",l),l.success===!0)return o.style.display="none",document.body.classList.add("show-booking-confirmation"),sessionStorage.setItem("booking_success",JSON.stringify({message:l.message,reservation_id:l.reservation_id})),window.dispatchEvent(new CustomEvent("booking:success",{detail:{message:l.message,reservationId:l.reservation_id}})),!0}}catch(j){console.error("Error handling JSON response:",j)}return!1};typeof document<"u"&&setTimeout(me,100);function De(){const{flash:o}=K().props,[j,c]=S.useState(!1),[l,v]=S.useState(null),{data:t,setData:b,errors:r,reset:N,setError:P,clearErrors:B,isSubmitting:w,setIsSubmitting:D,handleInputChange:d,roomTypes:J,availableRoomNumbers:m,isLoadingRooms:k,getAccommodationId:T}=te(),[E,C]=S.useState("");S.useEffect(()=>{try{const n=sessionStorage.getItem("booking_success");if(n){const x=JSON.parse(n);console.log("Found stored booking success:",x),sessionStorage.removeItem("booking_success"),v(x.reservation_id),c(!0);const g=document.querySelector(".inertia-error");g&&(g.style.display="none");return}}catch(n){console.error("Error checking sessionStorage:",n)}(()=>{const n=document.querySelector(".inertia-error");if(n)try{const g=(n.textContent||"").match(/\{.*\}/);if(g){const _=JSON.parse(g[0]);if(_.success===!0)return console.log("Found success JSON response:",_),_.reservation_id&&v(_.reservation_id),c(!0),N(),C(""),n.style.display="none",!0}}catch(x){console.error("Error parsing JSON response:",x)}return!1})(),o!=null&&o.success&&(p.success(o.success,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,style:{zIndex:9999}}),N()),o!=null&&o.error&&p.error(o.error,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,style:{zIndex:9999}});const u=n=>{console.log("Custom booking success event:",n.detail),n.detail.reservationId&&v(n.detail.reservationId),c(!0),N(),C("")};return window.addEventListener("booking:success",u),()=>{window.removeEventListener("booking:success",u)}},[o==null?void 0:o.success,o==null?void 0:o.error]);const V=s=>{s.preventDefault();const u=["first_name","last_name","email","phone","check_in_date","check_out_date","room_type","room_number","number_of_guests"];let n=!1;if(u.forEach(a=>{t[a]||(P(a,`${a.replace(/_/g," ")} is required`),n=!0)}),n){p.error("Please fill in all required fields");return}if(w)return;D(!0);const x=t.check_in_date?y(t.check_in_date,"yyyy-MM-dd"):"",g=t.check_out_date?y(t.check_out_date,"yyyy-MM-dd"):"",_=T(t.room_type,t.room_number);if(_===0){p.error("Invalid room selection"),D(!1);return}const H={first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone,accommodation_id:_.toString(),check_in:x,check_out:g,number_of_guests:t.number_of_guests,special_requests:t.special_requests||"",notes:t.special_requests||"",total_amount:"0",address:"Default Address",status:"pending"};A.post("/reservations",H).then(a=>{if(console.log("API response:",a.data),a.data.success){sessionStorage.setItem("booking_success",JSON.stringify({message:a.data.message,reservation_id:a.data.reservation_id})),a.data.reservation_id&&v(a.data.reservation_id),N(),C(""),c(!0),document.body.classList.add("show-booking-confirmation"),window.dispatchEvent(new CustomEvent("booking:success",{detail:{message:a.data.message,reservationId:a.data.reservation_id}}));const L=document.querySelector(".inertia-error");L&&(L.style.display="none")}else p.error(a.data.message||"An error occurred while creating the reservation")}).catch(a=>{console.error("Error submitting form:",a),A.isAxiosError(a)&&a.response?a.response.status===422&&a.response.data.errors?(console.error("Validation errors:",a.response.data.errors),p.error("Please check the form for errors and try again.")):p.error(a.response.data.message||"An error occurred. Please try again."):p.error("Network error. Please check your connection and try again.")}).finally(()=>{D(!1)})},G=()=>{c(!1),W.visit(route("dashboard"))},z=()=>{c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(se,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light",style:{zIndex:9999}}),e.jsx("style",{children:`
                body.show-booking-confirmation .inertia-error {
                    display: none !important;
                }
                `}),e.jsx(re,{open:j,onOpenChange:c,children:e.jsxs(ae,{className:"sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(ne,{className:"flex items-center",children:[e.jsx(de,{className:"mr-2 h-6 w-6 text-green-500"}),"Booking Successful!"]}),e.jsxs(ce,{children:["Your reservation has been created successfully.",l&&e.jsxs("span",{className:"block font-medium",children:["Reservation ID: ",l]})]})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{children:"Thank you for booking with Sky Nature Park!"}),e.jsx("p",{className:"mt-2",children:"A confirmation has been sent to your email."})]}),e.jsxs(ie,{className:"sm:justify-between",children:[e.jsx(I,{variant:"outline",onClick:z,children:"Create Another Booking"}),e.jsx(I,{className:"bg-[#47859e] hover:bg-[#3a7186]",onClick:G,children:"View Dashboard"})]})]})}),e.jsxs(ee,{breadcrumbs:[{title:"Create Booking",href:"/reservations/create"}],children:[e.jsx($,{title:"New Booking"}),e.jsx("div",{className:"container mx-auto select-none",children:e.jsxs(Y,{className:"rounded-none border-none",children:[e.jsx(Q,{children:e.jsx(U,{children:"Fill in the details to create a new reservation"})}),e.jsx(X,{children:e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Guest Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"firstName",children:"First Name"}),e.jsx(h,{id:"firstName",value:t.first_name,onChange:s=>d("first_name",s.target.value),placeholder:"Enter first name",className:r.first_name?"border-red-500":""}),r.first_name&&e.jsx("p",{className:"text-sm text-red-500",children:r.first_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lastName",children:"Last Name"}),e.jsx(h,{id:"lastName",value:t.last_name,onChange:s=>d("last_name",s.target.value),placeholder:"Enter last name",className:r.last_name?"border-red-500":""}),r.last_name&&e.jsx("p",{className:"text-sm text-red-500",children:r.last_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:t.email,onChange:s=>d("email",s.target.value),placeholder:"Enter email address",className:r.email?"border-red-500":""}),r.email&&e.jsx("p",{className:"text-sm text-red-500",children:r.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone Number"}),e.jsx(h,{id:"phone",value:t.phone,onChange:s=>d("phone",s.target.value),placeholder:"Enter phone number",className:r.phone?"border-red-500":""}),r.phone&&e.jsx("p",{className:"text-sm text-red-500",children:r.phone})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Booking Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"check-in",children:"Check-in Date"}),e.jsx(h,{id:"check-in",type:"date",value:t.check_in_date?y(new Date(t.check_in_date),"yyyy-MM-dd"):"",onChange:s=>{const u=s.target.value?new Date(s.target.value):null;b("check_in_date",u),B("check_in_date")},min:y(new Date,"yyyy-MM-dd"),onKeyDown:s=>s.preventDefault(),className:"max-w-[12rem]"}),r.check_in_date&&e.jsx("p",{className:"text-sm text-red-500",children:r.check_in_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"check-out",children:"Check-out Date"}),e.jsx(h,{id:"check-out",type:"date",value:t.check_out_date?y(new Date(t.check_out_date),"yyyy-MM-dd"):"",onChange:s=>{const u=s.target.value?new Date(s.target.value):null;b("check_out_date",u),B("check_out_date")},min:t.check_in_date?y(R(new Date(t.check_in_date),1),"yyyy-MM-dd"):y(R(new Date,1),"yyyy-MM-dd"),onKeyDown:s=>s.preventDefault(),className:"max-w-[12rem]"}),r.check_out_date&&e.jsx("p",{className:"text-sm text-red-500",children:r.check_out_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"roomType",children:"Room Type"}),e.jsxs(F,{value:t.room_type,onValueChange:s=>d("room_type",s),children:[e.jsx(O,{className:r.room_type?"border-red-500":"",children:e.jsx(q,{placeholder:"Select room type"})}),e.jsx(M,{children:J.map(s=>e.jsx(f,{value:s,children:s},s))})]}),r.room_type&&e.jsx("p",{className:"text-sm text-red-500",children:r.room_type}),t.room_type&&t.check_in_date&&t.check_out_date&&m.length===0&&!k&&e.jsxs("p",{className:"text-sm text-amber-500",children:["No ",t.room_type,"s available for the selected dates. Please try different dates or room type."]}),t.room_type&&t.check_in_date&&t.check_out_date&&m.length>0&&!k&&e.jsxs("p",{className:"text-sm text-green-500",children:["Found ",m.length," available ",t.room_type,m.length>1?"s":"",": ",m.join(", ")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"roomNumber",children:"Room Number"}),e.jsxs(F,{value:t.room_number,onValueChange:s=>d("room_number",s),disabled:!t.room_type||k||m.length===0,children:[e.jsx(O,{className:r.room_number?"border-red-500":"",children:e.jsx(q,{placeholder:t.room_type?k?"Loading...":m.length===0?"No rooms available":"Select room number":"Select room type first"})}),e.jsx(M,{children:m.map(s=>e.jsx(f,{value:s,children:s},s))})]}),r.room_number&&e.jsx("p",{className:"text-sm text-red-500",children:r.room_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"numberOfGuests",children:"Number of Guests"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{value:E,onValueChange:s=>{C(s),s==="custom"?b("number_of_guests",""):d("number_of_guests",s)},children:[e.jsx(O,{className:`flex-1 ${r.number_of_guests&&!E?"border-red-500":""}`,children:e.jsx(q,{placeholder:"Select number of guests"})}),e.jsxs(M,{children:[e.jsx(f,{value:"1",children:"1 Guest"}),e.jsx(f,{value:"2",children:"2 Guests"}),e.jsx(f,{value:"3",children:"3 Guests"}),e.jsx(f,{value:"4",children:"4 Guests"}),e.jsx(f,{value:"custom",children:"Custom number"})]})]}),E==="custom"&&e.jsx(h,{type:"number",min:"1",placeholder:"number of guests",value:t.number_of_guests,onChange:s=>d("number_of_guests",s.target.value),className:`w-42 ${r.number_of_guests?"border-red-500":""}`})]}),r.number_of_guests&&e.jsx("p",{className:"text-sm text-red-500",children:r.number_of_guests})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Additional Requests"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"specialRequests",children:"Special Requests"}),e.jsx(h,{id:"specialRequests",value:t.special_requests,onChange:s=>b("special_requests",s.target.value),placeholder:"Enter any special requests or requirements"}),r.special_requests&&e.jsx("p",{className:"text-sm text-red-500",children:r.special_requests})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(I,{type:"submit",className:"bg-[#47859e] hover:bg-[#3a7186]",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-2",children:"Creating..."}),e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]}):"Create Reservation"})})]})})]})})]})]})}export{De as default};
